graph TD
    subgraph "Phase 1: Data Ingestion"
        A(OpenSky Network API) -->|1. GET /states/all| B{Custom Fivetran Connector<br><em>Built with Python SDK</em>};
        B -->|2. Process & Upsert Data| C[Fivetran Platform];
    end

    subgraph "Phase 2: Data Warehousing"
        C -->|3. Load Real-Time Data| D;
        E(Static CSV: maintenance_schedules) -->|Manual Upload| F;
    end

    subgraph "Phase 3: AI Logic & Orchestration"
        G(Vertex AI Agent<br><em>'AeroTrack AI'</em>) -- Defines --> H{Custom Tool: 'find_incoming_aircraft'};
        H -- Invokes --> I(Google Cloud Function);
        I -->|4. SQL Query joins data| D;
        I -->| | F;
        I -->|5. Returns Structured JSON to Agent| G;
    end

    subgraph "Phase 4: User Application"
        J[User<br><em>(Logistics Manager)</em>] -->|6. Asks: 'Show planes needing A-check at JFK in 3 hrs'| K{Frontend Web App<br><em>(Deployed on Cloud Run)</em>};
        K -->|7. Sends Query via API Call| G;
        G -->|8. Synthesizes Natural Language Response| K;
        K -->|9. Displays Predictive Alert to User| J;
    end

    style A fill:#D6EAF8
    style B fill:#F5B7B1
    style D fill:#D5F5E3
    style F fill:#D5F5E3
    style G fill:#FCF3CF
    style K fill:#EBDEF0
